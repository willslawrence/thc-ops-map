<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THC Fleet Map ‚Äî 3 Feb 2026</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; }
  body { margin: 0; font-family: 'Inter', -apple-system, sans-serif; }
  #map { width: 100vw; height: 100vh; transition: height 0.3s ease; }
  body.timeline-open #map { height: 72vh; }
  
  .heli-pin {
    background: rgba(0,0,0,0.85); color: #7eb8ff; padding: 1px 4px;
    border-radius: 3px; font-size: 11px; font-weight: 700;
    white-space: nowrap; border: 1px solid #7eb8ff;
    text-align: center; line-height: 1.2;
  }
  .heli-pin.flying {
    color: #4caf50; border-color: #4caf50;
    animation: pulse 2s ease-in-out infinite;
  }
  .heli-pin.aog { color: #888; border-color: #666; }
  .heli-pin .sub { font-size: 8px; font-weight: 400; opacity: 0.7; display: block; }
  @keyframes pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(76,175,80,0.5); }
    50% { box-shadow: 0 0 8px 3px rgba(76,175,80,0.3); }
  }
  .base-label {
    background: none; color: rgba(255,255,255,0.4);
    font-size: 13px; font-weight: 600; letter-spacing: 1px;
    text-transform: uppercase;
  }
  .legend {
    background: rgba(15,15,30,0.75); backdrop-filter: blur(12px); color: #ddd; padding: 14px 18px;
    border-radius: 8px; font-size: 12px; line-height: 2.2;
    border: 1px solid rgba(255,255,255,0.12); width: 400px;
  }
  .legend h4 { margin: 0 0 6px; font-size: 14px; color: #fff; }
  .dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; vertical-align: middle; }

  .left-panels {
    position: fixed; top: 12px; left: 12px; z-index: 1000;
    width: 400px; max-height: calc(100vh - 24px); overflow-y: auto;
    display: flex; flex-direction: column; gap: 8px;
    scrollbar-width: thin; scrollbar-color: #333 transparent;
  }
  body.timeline-open .left-panels { max-height: 70vh; }
  .left-panels > div {
    background: rgba(15,15,30,0.75); backdrop-filter: blur(12px); color: #ddd;
    border-radius: 10px; border: 1px solid rgba(255,255,255,0.15);
    padding: 16px 20px; font-size: 12px; line-height: 1.7;
    scrollbar-width: thin; scrollbar-color: #333 transparent;
  }
  #briefing-panel { display: block; }
  #briefing-panel .panel-header { cursor: pointer; user-select: none; }
  #briefing-panel .panel-header:hover { opacity: 0.8; }
  #briefing-panel .panel-title { font-size: 16px; font-weight: 600; color: #fff; margin: 0 0 2px; }
  #briefing-panel .panel-date { font-size: 11px; color: #888; margin: 0 0 12px; }
  #briefing-panel .panel-body { transition: all 0.3s ease; }
  #briefing-panel.collapsed .panel-body { display: none; }
  #currency-panel.collapsed .panel-body { display: none; }

  .legend { cursor: pointer; user-select: none; }
  .legend:hover { opacity: 0.9; }
  .legend.collapsed .legend-body { display: none; }

  #briefing-panel h4 { font-size: 12px; color: #7eb8ff; margin: 12px 0 5px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 3px; }
  #briefing-panel .flight-row {
    display: flex; gap: 8px; padding: 3px 0;
    border-left: 2px solid #7eb8ff; padding-left: 8px; margin: 3px 0;
  }
  #briefing-panel .flight-row.today { border-left-color: #4caf50; }
  #briefing-panel .flight-row .reg { font-weight: 700; min-width: 50px; font-size: 11px; }
  #briefing-panel .flight-row .info { flex: 1; font-size: 11px; color: #aaa; }
  #briefing-panel .flight-row .pilot { font-size: 11px; color: #888; }
  #briefing-panel .alert, #currency-panel .alert { padding: 3px 8px; border-radius: 4px; font-size: 11px; margin: 3px 0; }
  #briefing-panel .alert.ok, #currency-panel .alert.ok { background: rgba(76,175,80,0.15); border-left: 2px solid #4caf50; }
  #briefing-panel .alert.warn, #currency-panel .alert.warn { background: rgba(255,193,7,0.12); border-left: 2px solid #ffc107; }
  #briefing-panel .alert.danger, #currency-panel .alert.danger { background: rgba(255,82,82,0.12); border-left: 2px solid #ff5252; }
  #briefing-panel .alert.info, #currency-panel .alert.info { background: rgba(52,152,219,0.15); border-left: 2px solid #3498db; }
  #currency-panel h4 { font-size: 12px; color: #7eb8ff; margin: 12px 0 5px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 3px; }

  #last-updated {
    position: fixed; top: 12px; right: 52px; z-index: 1000;
    background: rgba(15,15,30,0.75); backdrop-filter: blur(12px);
    color: #888; font-size: 11px;
    padding: 6px 12px; border-radius: 6px;
    border: 1px solid rgba(255,255,255,0.1);
  }

  /* Timeline Panel */
  .timeline-panel {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 28vh;
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
    border-top: 2px solid rgba(46, 204, 113, 0.5);
    transform: translateY(100%);
    transition: transform 0.3s ease;
    z-index: 1000;
    overflow: hidden;
  }
  body.timeline-open .timeline-panel { transform: translateY(0); }

  .timeline-toggle {
    position: fixed;
    bottom: 10px;
    right: 10px;
    background: rgba(15,15,30,0.85);
    backdrop-filter: blur(12px);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.2);
    padding: 8px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    z-index: 1001;
    transition: all 0.3s ease;
  }
  body.timeline-open .timeline-toggle { bottom: calc(40vh + 10px); }
  .timeline-toggle:hover { background: rgba(46, 204, 113, 0.3); border-color: rgba(46, 204, 113, 0.5); }

  /* Timeline Content */
  .timeline-content {
    padding: 8px 20px;
    height: 100%;
    overflow-x: auto;
  }
  .timeline-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
  }
  .timeline-title {
    font-size: 0.8rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    background: linear-gradient(90deg, #2ecc71, #3498db);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .timeline-legend {
    display: flex;
    gap: 12px;
    font-size: 0.55rem;
    color: #888;
  }
  .timeline-legend span { display: flex; align-items: center; gap: 4px; }
  .tl-dot { width: 6px; height: 6px; border-radius: 50%; }
  .tl-dot.current { background: #2ecc71; }
  .tl-dot.future { background: #3498db; }
  .tl-dot.pending { background: #e74c3c; }
  .tl-dot.past { background: #666; opacity: 0.5; }

  
  .timeline-wrapper {
    display: flex;
    height: 100%;
    gap: 15px;
  }
  .tbd-sidebar {
    width: 140px;
    flex-shrink: 0;
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    padding: 10px;
    overflow-y: auto;
  }
  .tbd-header {
    font-size: 0.65rem;
    font-weight: 600;
    color: #e74c3c;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .tbd-item {
    font-size: 0.55rem;
    color: #aaa;
    padding: 6px 8px;
    margin: 4px 0;
    background: rgba(231, 76, 60, 0.15);
    border-left: 2px solid #e74c3c;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .tbd-item:hover {
    background: rgba(231, 76, 60, 0.25);
    color: #fff;
  }
  .timeline-body {
    flex: 1;
    position: relative;
    min-width: 700px;
  }
  
  .lanes-above { padding-bottom: 6px; }
  .timeline-axis {
    position: relative;
    height: 18px;
    display: flex;
    align-items: center;
  }
  .axis-line {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, #2ecc71, #3498db, #2ecc71);
    transform: translateY(-50%);
  }
  .month-tick {
    position: absolute;
    top: 50%;
    transform: translateX(-50%);
    z-index: 10;
  }
  .month-tick::before {
    content: '';
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 2px;
    height: 12px;
    background: rgba(255,255,255,0.4);
    top: -6px;
  }
  .tick-label {
  .week-tick {
    position: absolute;
    top: 50%;
    transform: translateX(-50%);
    width: 1px;
    height: 6px;
    background: rgba(255,255,255,0.2);
    margin-top: -3px;
  }
    font-size: 0.45rem;
    font-weight: 600;
    color: #666;
    text-transform: uppercase;
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    white-space: nowrap;
  }
  .today-marker {
    position: absolute;
    top: -50px;
    bottom: -50px;
    width: 2px;
    background: #fff;
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
    z-index: 100;
  }
  .today-label {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.4rem;
    font-weight: 600;
    color: #fff;
    text-transform: uppercase;
    white-space: nowrap;
    background: rgba(255,255,255,0.15);
    padding: 1px 4px;
    border-radius: 2px;
  }
  .lanes-below { padding-top: 6px; }
  .lane {
    position: relative;
    height: 18px;
    margin-bottom: 2px;
  }
  .event-bar {
    position: absolute;
    height: 16px;
    min-width: 100px;
    border-radius: 3px;
    display: flex;
    align-items: center;
    padding: 0 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    overflow: visible;
    font-size: 0.5rem;
  }
  
  
  .event-bar.past {
    background: linear-gradient(135deg, rgba(100, 100, 100, 0.3), rgba(80, 80, 80, 0.2));
    border: 1px dashed rgba(150, 150, 150, 0.4);
    opacity: 0.5;
  }
  .event-bar.past:hover {
    opacity: 0.7;
  }
  .event-bar.past .event-title,
  .event-bar.past .event-dates {
    color: rgba(255, 255, 255, 0.6);
  }
  .event-bar.short {
    min-width: unset;
    padding: 0 4px;
  }
  .event-bar.short .event-title {
    font-size: 0.45rem;
  }
  .event-bar:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(0,0,0,0.4);
  }

/* Vertical separation used instead of minimized overlaps */
  .event-bar.current {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.85), rgba(46, 204, 113, 0.65));
    border: 1px solid rgba(46, 204, 113, 0.6);
  }
  .event-bar.future {
    background: linear-gradient(135deg, rgba(52, 152, 219, 0.85), rgba(52, 152, 219, 0.65));
    border: 1px solid rgba(52, 152, 219, 0.6);
  }
  .event-bar.pending {
    background: linear-gradient(135deg, rgba(231, 76, 60, 0.85), rgba(231, 76, 60, 0.65));
    border: 1px solid rgba(231, 76, 60, 0.6);
  }
  .event-icon { font-size: 0.65rem; margin-right: 4px; flex-shrink: 0; }
  .event-title { font-size: 0.55rem; font-weight: 600; white-space: nowrap; color: #fff; margin-right: 4px; }
  .event-dates { font-size: 0.45rem; opacity: 0.85; white-space: nowrap; }
  .event-aircraft { display: none; }
  .connector {
    position: absolute;
    width: 1px;
    opacity: 0.4;
  }
  .lanes-above .connector { bottom: -6px; height: 6px; }
  .lanes-below .connector { top: -6px; height: 6px; }
  .event-bar.current .connector { background: #2ecc71; }
  .event-bar.future .connector { background: #3498db; }
  .event-bar.pending .connector { background: #e74c3c; }

  /* Event popup */
  .event-popup {
    position: fixed;
    background: rgba(15, 15, 30, 0.95);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 8px;
    padding: 12px 16px;
    min-width: 200px;
    max-width: 280px;
    z-index: 2000;
    color: #fff;
    font-size: 12px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    display: none;
  }
  .event-popup.show { display: block; }
  .event-popup h3 {
    margin: 0 0 8px;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .event-popup .status-badge {
    font-size: 9px;
    padding: 2px 6px;
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 600;
  }
  .event-popup .status-badge.current { background: rgba(46, 204, 113, 0.3); color: #2ecc71; }
  .event-popup .status-badge.future { background: rgba(52, 152, 219, 0.3); color: #3498db; }
  .event-popup .status-badge.pending { background: rgba(231, 76, 60, 0.3); color: #e74c3c; }
  .event-popup .detail-row {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  .event-popup .detail-row:last-child { border-bottom: none; }
  .event-popup .detail-label { color: #888; }
  .event-popup .detail-value { color: #fff; font-weight: 500; }
</style>
</head>
<body>
<div id="map"></div>
<div id="last-updated">Last updated: <!-- LAST_UPDATED -->3 Feb 2026 11:14<!-- /LAST_UPDATED --></div>

<!-- Timeline Toggle Button -->
<button class="timeline-toggle" onclick="toggleTimeline()">üìÖ Missions</button>

<div class="left-panels">

<div id="briefing-panel" class="collapsed">
  <div class="panel-header" onclick="this.parentElement.classList.toggle('collapsed')">
    <div class="panel-title">üìã Ops Brief ‚ñæ</div>
    <div class="panel-date">OPS PLAN REPORT / <!-- REPORT_PERIOD -->31 Jan ‚Äì 05 Feb 2026<!-- /REPORT_PERIOD --></div>
  </div>
  <div class="panel-body">

  <!-- FLIGHTS_START -->
  <h4>03 Feb ‚Äî Today</h4>
  <div class="flight-row today"><span class="reg">RC33</span><span class="info">Training OEJF - THC</span><span class="pilot">Elgazzar / Aljuhani</span></div>
  <div class="flight-row today"><span class="reg">RC7</span><span class="info">Maint Check Flight OEJN - THC</span><span class="pilot">Ateyah / Fallatah</span></div>
  <div class="flight-row today"><span class="reg">RC74</span><span class="info">Off-Line Trg OETH - THC</span><span class="pilot">Schmidt / Salgado (FI)</span></div>
  <div class="flight-row today"><span class="reg">RC26</span><span class="info">Off-Line Trg OEGS - THC</span><span class="pilot">Druhan / Freire</span></div>
  <h4>04 Feb</h4>
  <div class="flight-row"><span class="reg">HC24</span><span class="info">Training XNPI-OENN-XNC1-XNPI - THC</span><span class="pilot">Mazzi / Alotaibi</span></div>
  <h4>05 Feb</h4>
  <div class="flight-row"><span class="reg">HC29</span><span class="info">Training XNC1 - THC</span><span class="pilot">Penalba Moldes / Gray</span></div>
  <div class="flight-row"><span class="reg">HC55</span><span class="info">Op Repo OEAO-XURC - AURORA</span><span class="pilot">Unassigned</span></div>
  <div class="flight-row"><span class="reg">HC5</span><span class="info">PAX121 XRSC-OERK-XRMK-OERK-XRSC - Bin Ayyaf</span><span class="pilot">Unassigned</span></div>
  <div class="flight-row"><span class="reg">RC26</span><span class="info">Off-Line Trg OEGS - THC</span><span class="pilot">Revuelta / Freire (FI)</span></div>
  <h4>06 Feb</h4>
  <div class="flight-row"><span class="reg">HC55</span><span class="info">Filming -133 XURC - AURORA</span><span class="pilot">Unassigned</span></div>
  <h4>07 Feb</h4>
  <div class="flight-row"><span class="reg">HC55</span><span class="info">Filming -133 XURC-XUFR - AURORA</span><span class="pilot">Unassigned</span></div>
  <h4>08 Feb</h4>
  <div class="flight-row"><span class="reg">HC55</span><span class="info">Op Repo XURC-OEHL-OEGS-XRSC - AURORA</span><span class="pilot">Unassigned</span></div>
  <div class="flight-row"><span class="reg">HC67</span><span class="info">Promo Filming OETH - Promo</span><span class="pilot">Unassigned</span></div>
  <div class="flight-row"><span class="reg">RC22</span><span class="info">Off-Line Trg OEGN - THC</span><span class="pilot">Manrique Benitez / Unassigned (FI)</span></div>
  <!-- FLIGHTS_END -->

  </div>
</div>

<div id="currency-panel" class="collapsed">
  <div class="panel-header" onclick="this.parentElement.classList.toggle('collapsed')">
    <div class="panel-title">ü©∫ Pilot Currency ‚ñæ</div>
  </div>
  <div class="panel-body">
  <!-- CURRENCY_START -->
  <h4>Competency Checks</h4>
  <div class="alert ok">‚úÖ Nobody due this or next month</div>
  <h4>30-Min REMS (6 month validity)</h4>
  <div class="alert danger">üî¥ Gilles P - expired Jan 2026</div>
  <div class="alert danger">üî¥ David S - expired Jan 2026</div>
  <div class="alert danger">üî¥ Nathan P - expired Jan 2026</div>
  <div class="alert danger">üî¥ Matthias K - expired Jun 2025</div>
  <div class="alert danger">üî¥ Matt O - expired Oct 2025</div>
  <h4>Medical Certificate (12 month validity)</h4>
  <div class="alert danger">üî¥ Nathan P - overdue since Jan 2026</div>
  <div class="alert warn">‚ö†Ô∏è Lisa R - due Feb 2026</div>
  <!-- CURRENCY_END -->
  </div>
</div>

</div><!-- /left-panels -->

<!-- Timeline Panel -->
<div class="timeline-panel">
  <div class="timeline-content">
    <div class="timeline-header">
      <div class="timeline-title">THC Missions 2026</div>
      <div class="timeline-legend">
        <span><div class="tl-dot current"></div>Current</span>
        <span><div class="tl-dot future"></div>Future</span>
        <span><div class="tl-dot pending"></div>Pending</span>
        <span><div class="tl-dot past"></div>Past</span>
      </div>
    </div>
    <!-- TIMELINE_START -->
    <div class="timeline-wrapper">
    <div class="timeline-body">
      <div class="lanes-above">
        <div class="lane">
          <div class="event-bar pending short" style="left:10.4%;width:1.2%;" data-name="Promo Filming" data-status="pending" data-dates="8 Feb" data-aircraft="TBD" data-pilots="TBD" onclick="showEventPopup(this,event)" title="Promo Filming (8 Feb)">
            <span class="event-title">Promo Film...</span>
          </div>
        </div>
        <div class="lane">
          <div class="event-bar active short" style="left:9.6%;width:1.2%;" data-name="Al Fursan Cup" data-status="active" data-dates="5-8 Feb" data-aircraft="TBD" data-pilots="Lisa" onclick="showEventPopup(this,event)" title="Al Fursan Cup (5-8 Feb)">
            <span class="event-title">Al Fursan ...</span>
          </div>
          <div class="event-bar pending short" style="left:25.3%;width:1.2%;" data-name="Yanbu Rally" data-status="pending" data-dates="3-4 Apr" data-aircraft="TBD" data-pilots="Ivona (Film), Matt (EMS 1/Sling), Lindsay (EMS 2), Will (VIP)" onclick="showEventPopup(this,event)" title="Yanbu Rally (3-4 Apr)">
            <span class="event-title">Yanbu Rally</span>
          </div>
          <div class="event-bar pending short" style="left:92.6%;width:1.2%;" data-name="Jeddah Rally 2026" data-status="pending" data-dates="4-5 Dec" data-aircraft="TBD" data-pilots="TBD" onclick="showEventPopup(this,event)" title="Jeddah Rally 2026 (4-5 Dec)">
            <span class="event-title">Jeddah Ral...</span>
          </div>
        </div>
        <div class="lane">
          <div class="event-bar past short" style="left:0.0%;width:4.7%;" data-name="Rally Dakar 2026" data-status="past" data-dates="27 Dec - 18 Jan" data-aircraft="TBD" data-pilots="Gilles, Ivona, Lindsay, Matt, Nathan, Stephan, Will" onclick="showEventPopup(this,event)" title="Rally Dakar 2026 (27 Dec - 18 Jan)">
            <span class="event-title">Rally Daka...</span>
          </div>
          <div class="event-bar complete short" style="left:7.7%;width:1.2%;" data-name="Rally Hail 2026" data-status="complete" data-dates="29 Jan - 1 Feb" data-aircraft="TBD" data-pilots="TBD" onclick="showEventPopup(this,event)" title="Rally Hail 2026 (29 Jan - 1 Feb)">
            <span class="event-title">Rally Hail...</span>
          </div>
          <div class="event-bar pending short" style="left:12.6%;width:1.2%;" data-name="Argas" data-status="pending" data-dates="16 Feb" data-aircraft="TBD" data-pilots="TBD" onclick="showEventPopup(this,event)" title="Argas (16 Feb)">
            <span class="event-title">Argas</span>
          </div>
          <div class="event-bar pending " style="left:16.2%;width:83.8%;" data-name="Bahrain Skybridge" data-status="pending" data-dates="1 Mar - 31 Dec" data-aircraft="TBD" data-pilots="TBD" onclick="showEventPopup(this,event)" title="Bahrain Skybridge (1 Mar - 31 Dec)">
            <span class="event-title">Bahrain Skybridge</span>
            <span class="event-dates">1 Mar - 31 Dec</span>
          </div>
        </div>
      </div>
      <div class="timeline-axis">
        <div class="axis-line"></div>
        <div class="month-tick" style="left:0.0%;"><span class="tick-label">Jan</span></div>
        <div class="month-tick" style="left:8.5%;"><span class="tick-label">Feb</span></div>
        <div class="month-tick" style="left:16.2%;"><span class="tick-label">Mar</span></div>
        <div class="month-tick" style="left:24.7%;"><span class="tick-label">Apr</span></div>
        <div class="month-tick" style="left:33.0%;"><span class="tick-label">May</span></div>
        <div class="month-tick" style="left:41.5%;"><span class="tick-label">Jun</span></div>
        <div class="month-tick" style="left:49.7%;"><span class="tick-label">Jul</span></div>
        <div class="month-tick" style="left:58.2%;"><span class="tick-label">Aug</span></div>
        <div class="month-tick" style="left:66.8%;"><span class="tick-label">Sep</span></div>
        <div class="month-tick" style="left:75.0%;"><span class="tick-label">Oct</span></div>
        <div class="month-tick" style="left:83.5%;"><span class="tick-label">Nov</span></div>
        <div class="month-tick" style="left:91.8%;"><span class="tick-label">Dec</span></div>
        <div class="week-tick" style="left:1.1%;"></div>
        <div class="week-tick" style="left:3.0%;"></div>
        <div class="week-tick" style="left:4.9%;"></div>
        <div class="week-tick" style="left:6.9%;"></div>
        <div class="week-tick" style="left:8.8%;"></div>
        <div class="week-tick" style="left:10.7%;"></div>
        <div class="week-tick" style="left:12.6%;"></div>
        <div class="week-tick" style="left:14.6%;"></div>
        <div class="week-tick" style="left:16.5%;"></div>
        <div class="week-tick" style="left:18.4%;"></div>
        <div class="week-tick" style="left:20.3%;"></div>
        <div class="week-tick" style="left:22.3%;"></div>
        <div class="week-tick" style="left:24.2%;"></div>
        <div class="week-tick" style="left:26.1%;"></div>
        <div class="week-tick" style="left:28.0%;"></div>
        <div class="week-tick" style="left:29.9%;"></div>
        <div class="week-tick" style="left:31.9%;"></div>
        <div class="week-tick" style="left:33.8%;"></div>
        <div class="week-tick" style="left:35.7%;"></div>
        <div class="week-tick" style="left:37.6%;"></div>
        <div class="week-tick" style="left:39.6%;"></div>
        <div class="week-tick" style="left:43.4%;"></div>
        <div class="week-tick" style="left:45.3%;"></div>
        <div class="week-tick" style="left:47.3%;"></div>
        <div class="week-tick" style="left:49.2%;"></div>
        <div class="week-tick" style="left:51.1%;"></div>
        <div class="week-tick" style="left:53.0%;"></div>
        <div class="week-tick" style="left:54.9%;"></div>
        <div class="week-tick" style="left:56.9%;"></div>
        <div class="week-tick" style="left:58.8%;"></div>
        <div class="week-tick" style="left:60.7%;"></div>
        <div class="week-tick" style="left:62.6%;"></div>
        <div class="week-tick" style="left:64.6%;"></div>
        <div class="week-tick" style="left:66.5%;"></div>
        <div class="week-tick" style="left:68.4%;"></div>
        <div class="week-tick" style="left:70.3%;"></div>
        <div class="week-tick" style="left:72.3%;"></div>
        <div class="week-tick" style="left:74.2%;"></div>
        <div class="week-tick" style="left:76.1%;"></div>
        <div class="week-tick" style="left:78.0%;"></div>
        <div class="week-tick" style="left:79.9%;"></div>
        <div class="week-tick" style="left:81.9%;"></div>
        <div class="week-tick" style="left:83.8%;"></div>
        <div class="week-tick" style="left:85.7%;"></div>
        <div class="week-tick" style="left:87.6%;"></div>
        <div class="week-tick" style="left:89.6%;"></div>
        <div class="week-tick" style="left:91.5%;"></div>
        <div class="week-tick" style="left:93.4%;"></div>
        <div class="week-tick" style="left:95.3%;"></div>
        <div class="week-tick" style="left:97.3%;"></div>
        <div class="week-tick" style="left:99.2%;"></div>
        <div class="today-marker" style="left:9.1%;"><span>Today</span></div>
      </div>
      <div class="lanes-below">
        <div class="lane">
          <div class="event-bar complete short" style="left:6.6%;width:1.9%;" data-name="AlUla Tour 2026" data-status="complete" data-dates="25 Jan - 1 Feb" data-aircraft="TBD" data-pilots="TBD" onclick="showEventPopup(this,event)" title="AlUla Tour 2026 (25 Jan - 1 Feb)">
            <span class="event-title">AlUla Tour...</span>
          </div>
          <div class="event-bar pending " style="left:16.2%;width:16.5%;" data-name="GeoTech" data-status="pending" data-dates="1 Mar - 30 Apr" data-aircraft="TBD" data-pilots="TBD" onclick="showEventPopup(this,event)" title="GeoTech (1 Mar - 30 Apr)">
            <span class="event-title">GeoTech</span>
            <span class="event-dates">1 Mar - 30 Apr</span>
          </div>
          <div class="event-bar pending short" style="left:34.9%;width:1.2%;" data-name="Rally Qassim 2026" data-status="pending" data-dates="8-9 May" data-aircraft="TBD" data-pilots="TBD" onclick="showEventPopup(this,event)" title="Rally Qassim 2026 (8-9 May)">
            <span class="event-title">Rally Qass...</span>
          </div>
          <div class="event-bar pending short" style="left:91.8%;width:1.2%;" data-name="WRC 2026" data-status="pending" data-dates="1-2 Dec" data-aircraft="TBD" data-pilots="Will (VIP)" onclick="showEventPopup(this,event)" title="WRC 2026 (1-2 Dec)">
            <span class="event-title">WRC 2026</span>
          </div>
        </div>
        <div class="lane">
          <div class="event-bar active " style="left:10.4%;width:89.6%;" data-name="Riyadh UAM" data-status="active" data-dates="8 Feb - 31 Dec" data-aircraft="TBD" data-pilots="Rohit Kaundinya, Will Lawrence, Lisa le Roux, David Leipsig, David Schicht" onclick="showEventPopup(this,event)" title="Riyadh UAM (8 Feb - 31 Dec)">
            <span class="event-title">Riyadh UAM</span>
            <span class="event-dates">8 Feb - 31 Dec</span>
          </div>
        </div>
      </div>
    </div>
    </div>
    <!-- TIMELINE_END -->

  </div>
</div>

<!-- Event Popup (outside timeline for z-index) -->
<div class="event-popup" id="eventPopup"></div>

<script>
function toggleTimeline() {
  document.body.classList.toggle('timeline-open');
  setTimeout(() => map.invalidateSize(), 350);
}

const bases = {
  OETH:  { lat: 25.213, lng: 46.640, name: "THUMAMAH" },
  RUH:   { lat: 24.680, lng: 46.820, name: "ALSALAM (RUH)" },
  OEHL:  { lat: 27.438, lng: 41.686, name: "HA'IL" },
  OEAO:  { lat: 26.485, lng: 38.126, name: "AL ULA" },
};

// FLEET_START
const fleet = [
  { reg: "HZHC52", loc: "RUH", status: "parked", mission: "Short Term Storage" },
  { reg: "HZHC54", loc: "OETH", status: "parked", mission: "Available" },
  { reg: "HZHC55", loc: "OEAO", status: "parked", mission: "Aurora Filming (repo OEAO‚ÜíXURC 05 Feb, filming 06-07 Feb, repo XRSC 08 Feb)" },
  { reg: "HZHC57", loc: "RUH", status: "maint" },
  { reg: "HZHC58", loc: "OETH", status: "maint" },
  { reg: "HZHC59", loc: "RUH", status: "parked" },
  { reg: "HZHC62", loc: "OETH", status: "maint" },
  { reg: "HZHC63", loc: "OETH", status: "parked", mission: "Available" },
  { reg: "HZHC64", loc: "OETH", status: "parked" },
  { reg: "HZHC65", loc: "OETH", status: "parked" },
  { reg: "HZHC66", loc: "RUH", status: "parked", mission: "UAM" },
  { reg: "HZHC67", loc: "OETH", status: "parked", mission: "UAM backup" },
  { reg: "HZHC68", loc: "OETH", status: "parked" },
  { reg: "HZHC69", loc: "OETH", status: "parked" },
];
// FLEET_END

const map = L.map('map', { zoomControl: false }).setView([26.2, 42.5], 6);
L.control.zoom({ position: 'topright' }).addTo(map);
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
  attribution: '¬© OSM ¬© CARTO', maxZoom: 18
}).addTo(map);

Object.values(bases).forEach(b => {
  L.marker([b.lat, b.lng], {
    icon: L.divIcon({ className: 'base-label', html: b.name, iconAnchor: [40, -20] }),
    interactive: false
  }).addTo(map);
  L.circle([b.lat, b.lng], { radius: 18000, color: 'rgba(255,255,255,0.08)', fillColor: 'rgba(255,255,255,0.03)', weight: 1 }).addTo(map);
});

const groups = {};
fleet.forEach(h => {
  if (!groups[h.loc]) groups[h.loc] = [];
  groups[h.loc].push(h);
});

fleet.forEach(h => {
  const b = bases[h.loc];
  if (!b) return;
  const g = groups[h.loc];
  const i = g.indexOf(h);
  const cols = Math.min(g.length, 3);
  const row = Math.floor(i / cols);
  const col = i % cols;
  const totalRows = Math.ceil(g.length / cols);
  const latOff = (row - (totalRows - 1) / 2) * 0.15;
  const lngOff = (col - (cols - 1) / 2) * 0.35;
  const lat = b.lat + latOff;
  const lng = b.lng + lngOff;

  const cls = h.status === 'flying' ? 'flying' : h.status === 'aog' ? 'aog' : h.status === 'maint' ? 'aog' : '';
  let label = h.reg.replace('HZHC','HC');
  if (h.pilot) label += `<span class="sub">${h.pilot}</span>`;
  if (h.status === 'aog') label += `<span class="sub">AOG</span>`;
  if (h.status === 'maint' && h.ert) label += `<span class="sub">ERT ${h.ert}</span>`;
  else if (h.status === 'maint') label += `<span class="sub">MAINT</span>`;

  const color = h.status === 'flying' ? '#4caf50' : h.status === 'aog' ? '#666' : h.status === 'maint' ? '#ff9800' : '#7eb8ff';
  L.circleMarker([lat, lng], {
    radius: 3, fillColor: color, color: '#fff', weight: 1, fillOpacity: 0.85
  }).addTo(map);

  L.marker([lat, lng], {
    icon: L.divIcon({
      className: `heli-pin ${cls}`,
      html: label,
      iconSize: [46, 18],
      iconAnchor: [-6, 12]
    })
  }).addTo(map).bindPopup(
    `<b>${h.reg}</b><br>Base: ${h.loc}` +
    `<br>Status: ${h.status === 'flying' ? 'üü¢ Flying' : h.status === 'maint' ? 'üü† Maintenance' : h.status === 'aog' ? 'üî¥ AOG' : 'üîµ Serviceable'}` +
    (h.ert ? `<br>üîß ERT: ${h.ert}` : '') +
    (h.note ? `<br><em>${h.note}</em>` : '') +
    (h.mission ? `<br>Mission: ${h.mission}` : '') +
    (h.totalFH ? `<br>Total FH: ${h.totalFH}` : '') +
    (h.remFH ? `<br>150hr Rem: ${h.remFH}` : '') +
    (h.next12mo ? `<br>12-Mo Due: ${h.next12mo}` : '') +
    (h.pilot ? `<br>PIC: ${h.pilot}` : '') + (h.route ? `<br>Route: ${h.route}` : '')
  );
});

// Draw flight path lines for helicopters with routes
fleet.filter(h => h.route && h.status === 'flying').forEach(h => {
  const parts = h.route.split(' ‚Üí ');
  if (parts.length === 2) {
    const origin = bases[parts[0]];
    const dest = bases[parts[1]];
    if (origin && dest && parts[0] !== parts[1]) {
      L.polyline([[origin.lat, origin.lng], [dest.lat, dest.lng]], {
        color: '#4caf50', weight: 2.5, opacity: 0.5, dashArray: '10 8'
      }).addTo(map).bindPopup(`<b>${h.reg}</b><br>${h.route}<br>PIC: ${h.pilot || 'TBD'}`);
    }
  }
});

const pts = fleet.filter(h => bases[h.loc]).map(h => [bases[h.loc].lat, bases[h.loc].lng]);
map.fitBounds(L.latLngBounds(pts).pad(0.15));

const legend = L.control({ position: 'bottomleft' });
legend.onAdd = () => {
  const d = L.DomUtil.create('div', 'legend collapsed');
  d.onclick = () => d.classList.toggle('collapsed');
  d.innerHTML = `
    <!-- LEGEND_START -->
    <h4>üöÅ H125 Fleet ‚Äî <!-- LEGEND_DATE -->31 Jan 2026<!-- /LEGEND_DATE --> ‚ñæ</h4>
    <div class="legend-body">
      <div><span class="dot" style="background:#7eb8ff"></span>Serviceable (${fleet.filter(h=>h.status==='parked').length})</div>
      <div><span class="dot" style="background:#4caf50"></span>Flying today (${fleet.filter(h=>h.status==='flying').length})</div>
      <div><span class="dot" style="background:#ff9800"></span>Maintenance (${fleet.filter(h=>h.status==='maint').length})</div>
    </div>
    <!-- LEGEND_END -->
  `;
  return d;
};
legend.addTo(map);

// Event popup handling (runs immediately - DOM already loaded)
(function() {
  const eventPopup = document.getElementById('eventPopup');
  const bars = document.querySelectorAll('.event-bar');
  
  bars.forEach(bar => {
    bar.onclick = function(e) {
      e.stopPropagation();
      const data = this.dataset;
      const statusLabel = data.status === 'current' ? 'Current' : data.status === 'future' ? 'Upcoming' : 'Pending';
      
      eventPopup.innerHTML = `
        <h3>
          ${data.name}
          <span class="status-badge ${data.status}">${statusLabel}</span>
        </h3>
        <div class="detail-row">
          <span class="detail-label">Dates</span>
          <span class="detail-value">${data.dates}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Aircraft</span>
          <span class="detail-value">${data.aircraft}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Pilots</span>
          <span class="detail-value">${data.pilots}</span>
        </div>
      `;
      
      // Position popup near click
      const rect = this.getBoundingClientRect();
      let left = rect.left;
      let top = rect.bottom + 8;
      if (left + 280 > window.innerWidth) left = window.innerWidth - 290;
      if (top + 150 > window.innerHeight) top = rect.top - 150;
      
      eventPopup.style.left = left + 'px';
      eventPopup.style.top = top + 'px';
      eventPopup.classList.add('show');
    };
  });

  // Close popup when clicking elsewhere
  document.body.onclick = function(e) {
    if (!e.target.closest('.event-bar')) {
      eventPopup.classList.remove('show');
    }
  };
})();

function showEventPopup(el, e) {
  e.stopPropagation();
  const popup = document.getElementById('eventPopup');
  const data = el.dataset;
  const statusLabel = data.status === 'current' ? 'Current' : data.status === 'future' ? 'Upcoming' : 'Pending';
  
  // Format aircraft roles as individual lines
  let aircraftHtml = data.aircraft;
  if (data.aircraft && data.aircraft.includes('|')) {
    aircraftHtml = data.aircraft.split(' | ').map(r => {
      const [role, reg] = r.split(': ');
      const isTBD = !reg || reg === 'TBD';
      return `<div style="padding:1px 0;"><span style="color:#888;">${role}:</span> <span style="color:${isTBD ? '#666' : '#7eb8ff'}">${reg || 'TBD'}</span></div>`;
    }).join('');
  }
  
  popup.innerHTML = `
    <h3>${data.name} <span class="status-badge ${data.status}">${statusLabel}</span></h3>
    <div class="detail-row"><span class="detail-label">Dates</span><span class="detail-value">${data.dates}</span></div>
    <div class="detail-row"><span class="detail-label">Aircraft</span><span class="detail-value">${aircraftHtml}</span></div>
    <div class="detail-row"><span class="detail-label">Pilots</span><span class="detail-value">${data.pilots}</span></div>
  `;
  
  const rect = el.getBoundingClientRect();
  popup.style.left = Math.min(rect.left, window.innerWidth - 290) + 'px';
  popup.style.top = (rect.top - 160) + 'px';
  popup.classList.add('show');
}

document.body.addEventListener('click', function(e) {
  if (!e.target.closest('.event-bar') && !e.target.closest('.event-popup')) {
    document.getElementById('eventPopup').classList.remove('show');
  }
});
</script>
</body>
</html>
