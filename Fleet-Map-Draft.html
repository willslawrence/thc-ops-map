<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>THC Fleet Map ‚Äî 31 Jan 2026</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
  * { box-sizing: border-box; }
  body { margin: 0; font-family: 'Inter', -apple-system, sans-serif; }
  #map { width: 100vw; height: 100vh; transition: height 0.3s ease; }
  body.timeline-open #map { height: 72vh; }
  
  .heli-pin {
    background: rgba(0,0,0,0.85); color: #7eb8ff; padding: 1px 4px;
    border-radius: 3px; font-size: 11px; font-weight: 700;
    white-space: nowrap; border: 1px solid #7eb8ff;
    text-align: center; line-height: 1.2;
  }
  .heli-pin.flying {
    color: #4caf50; border-color: #4caf50;
    animation: pulse 2s ease-in-out infinite;
  }
  .heli-pin.aog { color: #888; border-color: #666; }
  .heli-pin .sub { font-size: 8px; font-weight: 400; opacity: 0.7; display: block; }
  @keyframes pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(76,175,80,0.5); }
    50% { box-shadow: 0 0 8px 3px rgba(76,175,80,0.3); }
  }
  .base-label {
    background: none; color: rgba(255,255,255,0.4);
    font-size: 13px; font-weight: 600; letter-spacing: 1px;
    text-transform: uppercase;
  }
  .legend {
    background: rgba(15,15,30,0.75); backdrop-filter: blur(12px); color: #ddd; padding: 14px 18px;
    border-radius: 8px; font-size: 12px; line-height: 2.2;
    border: 1px solid rgba(255,255,255,0.12); width: 400px;
  }
  .legend h4 { margin: 0 0 6px; font-size: 14px; color: #fff; }
  .dot { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-right: 8px; vertical-align: middle; }

  .left-panels {
    position: fixed; top: 12px; left: 12px; z-index: 1000;
    width: 400px; max-height: calc(100vh - 24px); overflow-y: auto;
    display: flex; flex-direction: column; gap: 8px;
    scrollbar-width: thin; scrollbar-color: #333 transparent;
  }
  body.timeline-open .left-panels { max-height: 70vh; }
  .left-panels > div {
    background: rgba(15,15,30,0.75); backdrop-filter: blur(12px); color: #ddd;
    border-radius: 10px; border: 1px solid rgba(255,255,255,0.15);
    padding: 16px 20px; font-size: 12px; line-height: 1.7;
    scrollbar-width: thin; scrollbar-color: #333 transparent;
  }
  #briefing-panel { display: block; }
  #briefing-panel .panel-header { cursor: pointer; user-select: none; }
  #briefing-panel .panel-header:hover { opacity: 0.8; }
  #briefing-panel .panel-title { font-size: 16px; font-weight: 600; color: #fff; margin: 0 0 2px; }
  #briefing-panel .panel-date { font-size: 11px; color: #888; margin: 0 0 12px; }
  #briefing-panel .panel-body { transition: all 0.3s ease; }
  #briefing-panel.collapsed .panel-body { display: none; }
  #currency-panel.collapsed .panel-body { display: none; }

  .legend { cursor: pointer; user-select: none; }
  .legend:hover { opacity: 0.9; }
  .legend.collapsed .legend-body { display: none; }

  #briefing-panel h4 { font-size: 12px; color: #7eb8ff; margin: 12px 0 5px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 3px; }
  #briefing-panel .flight-row {
    display: flex; gap: 8px; padding: 3px 0;
    border-left: 2px solid #7eb8ff; padding-left: 8px; margin: 3px 0;
  }
  #briefing-panel .flight-row.today { border-left-color: #4caf50; }
  #briefing-panel .flight-row .reg { font-weight: 700; min-width: 50px; font-size: 11px; }
  #briefing-panel .flight-row .info { flex: 1; font-size: 11px; color: #aaa; }
  #briefing-panel .flight-row .pilot { font-size: 11px; color: #888; }
  #briefing-panel .alert, #currency-panel .alert { padding: 3px 8px; border-radius: 4px; font-size: 11px; margin: 3px 0; }
  #briefing-panel .alert.ok, #currency-panel .alert.ok { background: rgba(76,175,80,0.15); border-left: 2px solid #4caf50; }
  #briefing-panel .alert.warn, #currency-panel .alert.warn { background: rgba(255,193,7,0.12); border-left: 2px solid #ffc107; }
  #briefing-panel .alert.danger, #currency-panel .alert.danger { background: rgba(255,82,82,0.12); border-left: 2px solid #ff5252; }
  #briefing-panel .alert.info, #currency-panel .alert.info { background: rgba(52,152,219,0.15); border-left: 2px solid #3498db; }
  #currency-panel h4 { font-size: 12px; color: #7eb8ff; margin: 12px 0 5px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 3px; }

  #last-updated {
    position: fixed; top: 12px; right: 52px; z-index: 1000;
    background: rgba(15,15,30,0.75); backdrop-filter: blur(12px);
    color: #888; font-size: 11px;
    padding: 6px 12px; border-radius: 6px;
    border: 1px solid rgba(255,255,255,0.1);
  }

  /* Timeline Panel */
  .timeline-panel {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    height: 28vh;
    background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
    border-top: 2px solid rgba(46, 204, 113, 0.5);
    transform: translateY(100%);
    transition: transform 0.3s ease;
    z-index: 1000;
    overflow: hidden;
  }
  body.timeline-open .timeline-panel { transform: translateY(0); }

  .timeline-toggle {
    position: fixed;
    bottom: 10px;
    right: 10px;
    background: rgba(15,15,30,0.85);
    backdrop-filter: blur(12px);
    color: #fff;
    border: 1px solid rgba(255,255,255,0.2);
    padding: 8px 14px;
    border-radius: 6px;
    cursor: pointer;
    font-size: 12px;
    font-weight: 600;
    z-index: 1001;
    transition: all 0.3s ease;
  }
  body.timeline-open .timeline-toggle { bottom: calc(40vh + 10px); }
  .timeline-toggle:hover { background: rgba(46, 204, 113, 0.3); border-color: rgba(46, 204, 113, 0.5); }

  /* Timeline Content */
  .timeline-content {
    padding: 8px 20px;
    height: 100%;
    overflow-x: auto;
  }
  .timeline-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
  }
  .timeline-title {
    font-size: 0.8rem;
    font-weight: 700;
    letter-spacing: 2px;
    text-transform: uppercase;
    background: linear-gradient(90deg, #2ecc71, #3498db);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }
  .timeline-legend {
    display: flex;
    gap: 12px;
    font-size: 0.55rem;
    color: #888;
  }
  .timeline-legend span { display: flex; align-items: center; gap: 4px; }
  .tl-dot { width: 6px; height: 6px; border-radius: 50%; }
  .tl-dot.current { background: #2ecc71; }
  .tl-dot.future { background: #3498db; }
  .tl-dot.pending { background: #e74c3c; }
  .tl-dot.past { background: #666; opacity: 0.5; }

  
  .timeline-wrapper {
    display: flex;
    height: 100%;
    gap: 15px;
  }
  .tbd-sidebar {
    width: 140px;
    flex-shrink: 0;
    background: rgba(255,255,255,0.05);
    border-radius: 8px;
    padding: 10px;
    overflow-y: auto;
  }
  .tbd-header {
    font-size: 0.65rem;
    font-weight: 600;
    color: #e74c3c;
    margin-bottom: 8px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .tbd-item {
    font-size: 0.55rem;
    color: #aaa;
    padding: 6px 8px;
    margin: 4px 0;
    background: rgba(231, 76, 60, 0.15);
    border-left: 2px solid #e74c3c;
    border-radius: 3px;
    cursor: pointer;
    transition: all 0.2s;
  }
  .tbd-item:hover {
    background: rgba(231, 76, 60, 0.25);
    color: #fff;
  }
  .timeline-body {
    flex: 1;
    position: relative;
    min-width: 700px;
  }
  
  .lanes-above { padding-bottom: 6px; }
  .timeline-axis {
    position: relative;
    height: 18px;
    display: flex;
    align-items: center;
  }
  .axis-line {
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    background: linear-gradient(90deg, #2ecc71, #3498db, #2ecc71);
    transform: translateY(-50%);
  }
  .month-tick {
    position: absolute;
    top: 50%;
    transform: translateX(-50%);
    z-index: 10;
  }
  .month-tick::before {
    content: '';
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    width: 2px;
    height: 12px;
    background: rgba(255,255,255,0.4);
    top: -6px;
  }
  .tick-label {
    font-size: 0.45rem;
    font-weight: 600;
    color: #666;
    text-transform: uppercase;
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    white-space: nowrap;
  }
  .today-marker {
    position: absolute;
    top: -50px;
    bottom: -50px;
    width: 2px;
    background: #fff;
    box-shadow: 0 0 8px rgba(255, 255, 255, 0.6);
    z-index: 100;
  }
  .today-label {
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.4rem;
    font-weight: 600;
    color: #fff;
    text-transform: uppercase;
    white-space: nowrap;
    background: rgba(255,255,255,0.15);
    padding: 1px 4px;
    border-radius: 2px;
  }
  .lanes-below { padding-top: 6px; }
  .lane {
    position: relative;
    height: 18px;
    margin-bottom: 2px;
  }
  .event-bar {
    position: absolute;
    height: 16px;
    min-width: 100px;
    border-radius: 3px;
    display: flex;
    align-items: center;
    padding: 0 6px;
    cursor: pointer;
    transition: all 0.2s ease;
    overflow: visible;
    font-size: 0.5rem;
  }
  
  
  .event-bar.past {
    background: linear-gradient(135deg, rgba(100, 100, 100, 0.3), rgba(80, 80, 80, 0.2));
    border: 1px dashed rgba(150, 150, 150, 0.4);
    opacity: 0.5;
  }
  .event-bar.past:hover {
    opacity: 0.7;
  }
  .event-bar.past .event-title,
  .event-bar.past .event-dates {
    color: rgba(255, 255, 255, 0.6);
  }
  .event-bar.short {
    min-width: unset;
    padding: 0 4px;
  }
  .event-bar.short .event-title {
    font-size: 0.45rem;
  }
  .event-bar:hover {
    transform: translateY(-1px);
    box-shadow: 0 3px 10px rgba(0,0,0,0.4);
  }

/* Vertical separation used instead of minimized overlaps */
  .event-bar.current {
    background: linear-gradient(135deg, rgba(46, 204, 113, 0.85), rgba(46, 204, 113, 0.65));
    border: 1px solid rgba(46, 204, 113, 0.6);
  }
  .event-bar.future {
    background: linear-gradient(135deg, rgba(52, 152, 219, 0.85), rgba(52, 152, 219, 0.65));
    border: 1px solid rgba(52, 152, 219, 0.6);
  }
  .event-bar.pending {
    background: linear-gradient(135deg, rgba(231, 76, 60, 0.85), rgba(231, 76, 60, 0.65));
    border: 1px solid rgba(231, 76, 60, 0.6);
  }
  .event-icon { font-size: 0.65rem; margin-right: 4px; flex-shrink: 0; }
  .event-title { font-size: 0.55rem; font-weight: 600; white-space: nowrap; color: #fff; margin-right: 4px; }
  .event-dates { font-size: 0.45rem; opacity: 0.85; white-space: nowrap; }
  .event-aircraft { display: none; }
  .connector {
    position: absolute;
    width: 1px;
    opacity: 0.4;
  }
  .lanes-above .connector { bottom: -6px; height: 6px; }
  .lanes-below .connector { top: -6px; height: 6px; }
  .event-bar.current .connector { background: #2ecc71; }
  .event-bar.future .connector { background: #3498db; }
  .event-bar.pending .connector { background: #e74c3c; }

  /* Event popup */
  .event-popup {
    position: fixed;
    background: rgba(15, 15, 30, 0.95);
    backdrop-filter: blur(12px);
    border: 1px solid rgba(255,255,255,0.2);
    border-radius: 8px;
    padding: 12px 16px;
    min-width: 200px;
    max-width: 280px;
    z-index: 2000;
    color: #fff;
    font-size: 12px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.5);
    display: none;
  }
  .event-popup.show { display: block; }
  .event-popup h3 {
    margin: 0 0 8px;
    font-size: 14px;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .event-popup .status-badge {
    font-size: 9px;
    padding: 2px 6px;
    border-radius: 3px;
    text-transform: uppercase;
    font-weight: 600;
  }
  .event-popup .status-badge.current { background: rgba(46, 204, 113, 0.3); color: #2ecc71; }
  .event-popup .status-badge.future { background: rgba(52, 152, 219, 0.3); color: #3498db; }
  .event-popup .status-badge.pending { background: rgba(231, 76, 60, 0.3); color: #e74c3c; }
  .event-popup .detail-row {
    display: flex;
    justify-content: space-between;
    padding: 4px 0;
    border-bottom: 1px solid rgba(255,255,255,0.1);
  }
  .event-popup .detail-row:last-child { border-bottom: none; }
  .event-popup .detail-label { color: #888; }
  .event-popup .detail-value { color: #fff; font-weight: 500; }
</style>
</head>
<body>
<div id="map"></div>
<div id="last-updated">Last updated: <!-- LAST_UPDATED -->31 Jan 2026 17:40<!-- /LAST_UPDATED --></div>

<!-- Timeline Toggle Button -->
<button class="timeline-toggle" onclick="toggleTimeline()">üìÖ Missions</button>

<div class="left-panels">

<div id="briefing-panel" class="collapsed">
  <div class="panel-header" onclick="this.parentElement.classList.toggle('collapsed')">
    <div class="panel-title">üìã Ops Brief ‚ñæ</div>
    <div class="panel-date">OPS PLAN REPORT / <!-- REPORT_PERIOD -->31 Jan ‚Äì 05 Feb 2026<!-- /REPORT_PERIOD --></div>
  </div>
  <div class="panel-body">

  <!-- FLIGHTS_START -->
  <h4>Today ‚Äî 31 Jan</h4>
  <div class="flight-row today"><span class="reg">HC54</span><span class="info">PAX135 - SMC</span><span class="pilot">Schicht</span></div>
  <div class="flight-row today"><span class="reg">HC62</span><span class="info">PAX135 - SMC</span><span class="pilot">Lawrence</span></div>
  <div class="flight-row today"><span class="reg">HC63</span><span class="info">PAX135 - SMC</span><span class="pilot">Leipsig</span></div>
  <div class="flight-row today"><span class="reg">HC58</span><span class="info">Filming -133 - SMC</span><span class="pilot">Mayer</span></div>
  <div class="flight-row today"><span class="reg">HC55</span><span class="info">Filming -133 - AlUla Tour 2026</span><span class="pilot">Bonet</span></div>
  <h4>01 Feb ‚Äî Repositioning to OETH</h4>
  <div class="flight-row"><span class="reg">HC54</span><span class="info">Operational Reposition - OETH</span><span class="pilot">Schicht</span></div>
  <div class="flight-row"><span class="reg">HC58</span><span class="info">Operational Reposition - OETH</span><span class="pilot">Mayer</span></div>
  <div class="flight-row"><span class="reg">HC62</span><span class="info">Operational Reposition - OETH</span><span class="pilot">Lawrence</span></div>
  <div class="flight-row"><span class="reg">HC63</span><span class="info">Operational Reposition - OETH</span><span class="pilot">Leipsig</span></div>
  <!-- FLIGHTS_END -->

  </div>
</div>

<div id="currency-panel" class="collapsed">
  <div class="panel-header" onclick="this.parentElement.classList.toggle('collapsed')">
    <div class="panel-title">ü©∫ Pilot Currency ‚ñæ</div>
  </div>
  <div class="panel-body">
  <!-- CURRENCY_START -->
  <h4>Competency Checks</h4>
  <div class="alert warn">‚ö†Ô∏è January ‚Äî Matthias Klemp</div>
  <div class="alert ok">‚úÖ February ‚Äî nobody due</div>
  <h4>30-Min REMS (6 month cycle)</h4>
  <div class="alert danger">üî¥ Matthias Klemp ‚Äî expired July 2025</div>
  <div class="alert danger">üî¥ Matt O'brien ‚Äî expired November 2025</div>
  <h4>Medical Certificate (12 month validity)</h4>
  <div class="alert warn">‚ö†Ô∏è Nathan Piper ‚Äî January</div>
  <!-- CURRENCY_END -->
  </div>
</div>

</div><!-- /left-panels -->

<!-- Timeline Panel -->
<div class="timeline-panel">
  <div class="timeline-content">
    <div class="timeline-header">
      <div class="timeline-title">THC Missions 2026</div>
      <div class="timeline-legend">
        <span><div class="tl-dot current"></div>Current</span>
        <span><div class="tl-dot future"></div>Future</span>
        <span><div class="tl-dot pending"></div>Pending</span>
        <span><div class="tl-dot past"></div>Past</span>
      </div>
    </div>
    <!-- TIMELINE_START -->
    <div class="timeline-wrapper">
    <div class="tbd-sidebar">
      <div class="tbd-header">üìã Dates TBD</div>
      <div class="tbd-item" data-name="Argas" data-status="pending" 
           data-dates="TBD" data-aircraft="TBD" 
           data-pilots="TBD" onclick="showEventPopup(this, event)">
        Argas
      </div>
      <div class="tbd-item" data-name="GeoTech" data-status="pending" 
           data-dates="TBD" data-aircraft="TBD" 
           data-pilots="TBD" onclick="showEventPopup(this, event)">
        GeoTech
      </div>
    </div>
    <div class="timeline-body">
      <div class="lanes-above">
        <div class="lane">
          <div class="event-bar past short" style="left: 14.035087719298245%; width: 1.2%;"
               data-name="Rally Jeddah 2025" data-status="past" 
               data-dates="4-8 Dec" data-aircraft="HZHC62, HZHC55, HZHC59, HZHC57" 
               data-pilots="Ivona, Will, Nathan, Lisa" onclick="showEventPopup(this, event)"
               title="Rally Jeddah 2025 (4-8 Dec)">
            <span class="event-title">Rally Jedd‚Ä¶</span>
          </div>
          <div class="event-bar pending" style="left: 33.114035087719294%; width: 66.88596491228071%;"
               data-name="Skybridge" data-status="pending" 
               data-dates="1 Mar - 31 Dec" data-aircraft="TBD" 
               data-pilots="TBD" onclick="showEventPopup(this, event)">
            <span class="event-title">Skybridge</span>
            <span class="event-dates">1 Mar - 31 Dec</span>
          </div>
        </div>
        <div class="lane">
          <div class="event-bar past" style="left: 6.798245614035088%; width: 4.166666666666665%;"
               data-name="Trojena Gear Removal 2025" data-status="past" 
               data-dates="1-20 Nov" data-aircraft="HZHC54" 
               data-pilots="TBD" onclick="showEventPopup(this, event)">
            <span class="event-title">Trojena Gear Removal 2025</span>
            <span class="event-dates">1-20 Nov</span>
          </div>
          <div class="event-bar future short" style="left: 28.07017543859649%; width: 1.2%;"
               data-name="Al Fursan Cup" data-status="future" 
               data-dates="6-7 Feb" data-aircraft="HZHC55" 
               data-pilots="Lisa" onclick="showEventPopup(this, event)"
               title="Al Fursan Cup (6-7 Feb)">
            <span class="event-title">Al Fursan ‚Ä¶</span>
          </div>
        </div>
        <div class="lane">
          <div class="event-bar past short" style="left: 5.701754385964912%; width: 1.2%;"
               data-name="GHE 2025" data-status="past" 
               data-dates="27-30 Oct" data-aircraft="H125, AW139" 
               data-pilots="TBD" onclick="showEventPopup(this, event)"
               title="GHE 2025 (27-30 Oct)">
            <span class="event-title">GHE 2025</span>
          </div>
          <div class="event-bar current" style="left: 25.438596491228072%; width: 1.535087719298243%;"
               data-name="AlUla Tour 2026" data-status="current" 
               data-dates="25 Jan - 1 Feb" data-aircraft="HZHC55" 
               data-pilots="Bonet" onclick="showEventPopup(this, event)">
            <span class="event-title">AlUla Tour 2026</span>
            <span class="event-dates">25 Jan - 1 Feb</span>
          </div>
          <div class="event-bar pending short" style="left: 48.026315789473685%; width: 1.2%;"
               data-name="Rally Qassim 2026" data-status="pending" 
               data-dates="8-9 May" data-aircraft="TBD" 
               data-pilots="TBD" onclick="showEventPopup(this, event)"
               title="Rally Qassim 2026 (8-9 May)">
            <span class="event-title">Rally Qass‚Ä¶</span>
          </div>
        </div>
      </div>
      <div class="timeline-axis">
        <div class="axis-line"></div>
        <div class="today-marker" style="left: 26.75438596491228%;"><div class="today-label">TODAY</div></div>
        <div class="month-tick" style="left: 0%;"><span class="tick-label">Oct 25</span></div>
        <div class="month-tick" style="left: 6.7%;"><span class="tick-label">Nov</span></div>
        <div class="month-tick" style="left: 13.3%;"><span class="tick-label">Dec</span></div>
        <div class="month-tick" style="left: 20%;"><span class="tick-label">Jan 26</span></div>
        <div class="month-tick" style="left: 26.7%;"><span class="tick-label">Feb</span></div>
        <div class="month-tick" style="left: 33.3%;"><span class="tick-label">Mar</span></div>
        <div class="month-tick" style="left: 40%;"><span class="tick-label">Apr</span></div>
        <div class="month-tick" style="left: 46.7%;"><span class="tick-label">May</span></div>
        <div class="month-tick" style="left: 53.3%;"><span class="tick-label">Jun</span></div>
        <div class="month-tick" style="left: 60%;"><span class="tick-label">Jul</span></div>
        <div class="month-tick" style="left: 66.7%;"><span class="tick-label">Aug</span></div>
        <div class="month-tick" style="left: 73.3%;"><span class="tick-label">Sep</span></div>
        <div class="month-tick" style="left: 80%;"><span class="tick-label">Oct</span></div>
        <div class="month-tick" style="left: 86.7%;"><span class="tick-label">Nov</span></div>
        <div class="month-tick" style="left: 93.3%;"><span class="tick-label">Dec</span></div>
      </div>
      <div class="lanes-below">
        <div class="lane">
          <div class="event-bar past short" style="left: 6.359649122807018%; width: 1.2%;"
               data-name="Rally Qassim 2025" data-status="past" 
               data-dates="30 Oct - 3 Nov" data-aircraft="HZHC57, HZHC55, HZHC58" 
               data-pilots="Will, Ivona, Stephan" onclick="showEventPopup(this, event)"
               title="Rally Qassim 2025 (30 Oct - 3 Nov)">
            <span class="event-title">Rally Qass‚Ä¶</span>
          </div>
          <div class="event-bar current short" style="left: 26.31578947368421%; width: 1.2%;"
               data-name="Rally Hail 2026" data-status="current" 
               data-dates="29 Jan - 1 Feb" data-aircraft="HZHC54, HZHC58, HZHC62, HZHC63" 
               data-pilots="David, Stephan, Will, David L" onclick="showEventPopup(this, event)"
               title="Rally Hail 2026 (29 Jan - 1 Feb)">
            <span class="event-title">Rally Hail‚Ä¶</span>
          </div>
          <div class="event-bar pending short" style="left: 94.07894736842105%; width: 1.2%;"
               data-name="Jeddah Rally 2026" data-status="pending" 
               data-dates="4-5 Dec" data-aircraft="TBD" 
               data-pilots="TBD" onclick="showEventPopup(this, event)"
               title="Jeddah Rally 2026 (4-5 Dec)">
            <span class="event-title">Jeddah Ral‚Ä¶</span>
          </div>
        </div>
        <div class="lane">
          <div class="event-bar past short" style="left: 12.06140350877193%; width: 1.3157894736842106%;"
               data-name="Rally WRC 2025" data-status="past" 
               data-dates="25 Nov - 1 Dec" data-aircraft="HZHC57, HZHC55, HZHC62, HZHC64, HZHC59" 
               data-pilots="Will, Roberto, Nathan, David, Lisa" onclick="showEventPopup(this, event)"
               title="Rally WRC 2025 (25 Nov - 1 Dec)">
            <span class="event-title">Rally WRC ‚Ä¶</span>
          </div>
          <div class="event-bar future" style="left: 28.50877192982456%; width: 71.49122807017544%;"
               data-name="Riyadh UAM" data-status="future" 
               data-dates="8 Feb - 31 Dec" data-aircraft="HZHC66, HZHC67" 
               data-pilots="Rohit Kaundinya, Will Lawrence, Lisa le Roux, David Leipsig, David Schicht" onclick="showEventPopup(this, event)">
            <span class="event-title">Riyadh UAM</span>
            <span class="event-dates">8 Feb - 31 Dec</span>
          </div>
        </div>
        <div class="lane">
          <div class="event-bar past" style="left: 19.078947368421055%; width: 4.8245614035087705%;"
               data-name="Rally Dakar 2026" data-status="past" 
               data-dates="27 Dec - 18 Jan" data-aircraft="TBD" 
               data-pilots="Gilles, Ivona, Lindsay, Matt, Nathan, Stephan, Will" onclick="showEventPopup(this, event)">
            <span class="event-title">Rally Dakar 2026</span>
            <span class="event-dates">27 Dec - 18 Jan</span>
          </div>
          <div class="event-bar pending short" style="left: 40.35087719298245%; width: 1.2%;"
               data-name="Al Jouf Rally" data-status="pending" 
               data-dates="3-4 Apr" data-aircraft="TBD" 
               data-pilots="TBD" onclick="showEventPopup(this, event)"
               title="Al Jouf Rally (3-4 Apr)">
            <span class="event-title">Al Jouf Ra‚Ä¶</span>
          </div>
        </div>
      </div>
    </div>
    </div>
    <!-- TIMELINE_END -->

  </div>
</div>

<!-- Event Popup (outside timeline for z-index) -->
<div class="event-popup" id="eventPopup"></div>

<script>
function toggleTimeline() {
  document.body.classList.toggle('timeline-open');
  setTimeout(() => map.invalidateSize(), 350);
}

const bases = {
  OETH:  { lat: 25.213, lng: 46.640, name: "THUMAMAH" },
  RUH:   { lat: 24.680, lng: 46.820, name: "ALSALAM (RUH)" },
  OEHL:  { lat: 27.438, lng: 41.686, name: "HA'IL" },
  OEAO:  { lat: 26.485, lng: 38.126, name: "AL ULA" },
};

// FLEET_START
const fleet = [
  { reg: "HZHC52", loc: "RUH", status: "parked", note: "For Sale" },
  { reg: "HZHC54", loc: "OEHL", status: "flying", mission: "PAX135 - SMC", pilot: "Schicht" },
  { reg: "HZHC55", loc: "OEAO", status: "flying", mission: "Filming -133 - AlUla Tour 2026", pilot: "Bonet" },
  { reg: "HZHC57", loc: "RUH", status: "maint", note: "Post Dakar" },
  { reg: "HZHC58", loc: "OEHL", status: "flying", mission: "Filming -133 - SMC", pilot: "Mayer" },
  { reg: "HZHC59", loc: "RUH", status: "parked" },
  { reg: "HZHC62", loc: "OEHL", status: "flying", mission: "PAX135 - SMC", pilot: "Lawrence" },
  { reg: "HZHC63", loc: "OEHL", status: "flying", mission: "PAX135 - SMC", pilot: "Leipsig" },
  { reg: "HZHC64", loc: "OETH", status: "parked", note: "MEL, Waiting AC Oil" },
  { reg: "HZHC65", loc: "OETH", status: "parked" },
  { reg: "HZHC66", loc: "RUH", status: "parked", mission: "UAM" },
  { reg: "HZHC67", loc: "OETH", status: "parked", mission: "UAM backup" },
  { reg: "HZHC68", loc: "OETH", status: "parked" },
  { reg: "HZHC69", loc: "OETH", status: "parked" },
];
// FLEET_END

const map = L.map('map', { zoomControl: false }).setView([26.2, 42.5], 6);
L.control.zoom({ position: 'topright' }).addTo(map);
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
  attribution: '¬© OSM ¬© CARTO', maxZoom: 18
}).addTo(map);

Object.values(bases).forEach(b => {
  L.marker([b.lat, b.lng], {
    icon: L.divIcon({ className: 'base-label', html: b.name, iconAnchor: [40, -20] }),
    interactive: false
  }).addTo(map);
  L.circle([b.lat, b.lng], { radius: 18000, color: 'rgba(255,255,255,0.08)', fillColor: 'rgba(255,255,255,0.03)', weight: 1 }).addTo(map);
});

const groups = {};
fleet.forEach(h => {
  if (!groups[h.loc]) groups[h.loc] = [];
  groups[h.loc].push(h);
});

fleet.forEach(h => {
  const b = bases[h.loc];
  if (!b) return;
  const g = groups[h.loc];
  const i = g.indexOf(h);
  const cols = Math.min(g.length, 3);
  const row = Math.floor(i / cols);
  const col = i % cols;
  const totalRows = Math.ceil(g.length / cols);
  const latOff = (row - (totalRows - 1) / 2) * 0.15;
  const lngOff = (col - (cols - 1) / 2) * 0.35;
  const lat = b.lat + latOff;
  const lng = b.lng + lngOff;

  const cls = h.status === 'flying' ? 'flying' : h.status === 'aog' ? 'aog' : h.status === 'maint' ? 'aog' : '';
  let label = h.reg.replace('HZHC','HC');
  if (h.pilot) label += `<span class="sub">${h.pilot}</span>`;
  if (h.status === 'aog') label += `<span class="sub">AOG</span>`;
  if (h.status === 'maint') label += `<span class="sub">MAINT</span>`;

  const color = h.status === 'flying' ? '#4caf50' : h.status === 'aog' ? '#666' : h.status === 'maint' ? '#ff9800' : '#7eb8ff';
  L.circleMarker([lat, lng], {
    radius: 3, fillColor: color, color: '#fff', weight: 1, fillOpacity: 0.85
  }).addTo(map);

  L.marker([lat, lng], {
    icon: L.divIcon({
      className: `heli-pin ${cls}`,
      html: label,
      iconSize: [46, 18],
      iconAnchor: [-6, 12]
    })
  }).addTo(map).bindPopup(
    `<b>${h.reg}</b><br>Base: ${h.loc}` +
    `<br>Status: ${h.status === 'flying' ? 'üü¢ Flying' : h.status === 'maint' ? 'üü† Maintenance' : h.status === 'aog' ? 'üî¥ AOG' : 'üîµ Serviceable'}` +
    (h.note ? `<br><em>${h.note}</em>` : '') +
    (h.mission ? `<br>Mission: ${h.mission}` : '') +
    (h.pilot ? `<br>PIC: ${h.pilot}` : '')
  );
});

const filmLat = 26 + 48/60 + 46.92/3600;
const filmLng = 37 + 56/60 + 7.56/3600;
const ao = bases.OEAO;
L.polyline([[ao.lat, ao.lng],[filmLat, filmLng]], {
  color: '#4caf50', weight: 2.5, opacity: 0.5, dashArray: '10 8'
}).addTo(map).bindPopup('<b>HC55 ‚Äì Filming</b><br>AlUla Tour 2026<br>PIC: Julio Bonet');

L.circleMarker([filmLat, filmLng], {
  radius: 5, fillColor: '#4caf50', color: '#fff', weight: 1, fillOpacity: 0.6
}).addTo(map).bindPopup("Filming Point<br>26¬∞48'47\"N 37¬∞56'08\"E");

const pts = fleet.filter(h => bases[h.loc]).map(h => [bases[h.loc].lat, bases[h.loc].lng]);
pts.push([filmLat, filmLng]);
map.fitBounds(L.latLngBounds(pts).pad(0.15));

const legend = L.control({ position: 'bottomleft' });
legend.onAdd = () => {
  const d = L.DomUtil.create('div', 'legend collapsed');
  d.onclick = () => d.classList.toggle('collapsed');
  d.innerHTML = `
    <!-- LEGEND_START -->
    <h4>üöÅ H125 Fleet ‚Äî <!-- LEGEND_DATE -->31 Jan 2026<!-- /LEGEND_DATE --> ‚ñæ</h4>
    <div class="legend-body">
      <div><span class="dot" style="background:#7eb8ff"></span>Serviceable (${fleet.filter(h=>h.status==='parked').length})</div>
      <div><span class="dot" style="background:#4caf50"></span>Flying today (${fleet.filter(h=>h.status==='flying').length})</div>
      <div><span class="dot" style="background:#ff9800"></span>Maintenance (${fleet.filter(h=>h.status==='maint').length})</div>
    </div>
    <!-- LEGEND_END -->
  `;
  return d;
};
legend.addTo(map);

// Event popup handling (runs immediately - DOM already loaded)
(function() {
  const eventPopup = document.getElementById('eventPopup');
  const bars = document.querySelectorAll('.event-bar');
  
  bars.forEach(bar => {
    bar.onclick = function(e) {
      e.stopPropagation();
      const data = this.dataset;
      const statusLabel = data.status === 'current' ? 'Current' : data.status === 'future' ? 'Upcoming' : 'Pending';
      
      eventPopup.innerHTML = `
        <h3>
          ${data.name}
          <span class="status-badge ${data.status}">${statusLabel}</span>
        </h3>
        <div class="detail-row">
          <span class="detail-label">Dates</span>
          <span class="detail-value">${data.dates}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Aircraft</span>
          <span class="detail-value">${data.aircraft}</span>
        </div>
        <div class="detail-row">
          <span class="detail-label">Pilots</span>
          <span class="detail-value">${data.pilots}</span>
        </div>
      `;
      
      // Position popup near click
      const rect = this.getBoundingClientRect();
      let left = rect.left;
      let top = rect.bottom + 8;
      if (left + 280 > window.innerWidth) left = window.innerWidth - 290;
      if (top + 150 > window.innerHeight) top = rect.top - 150;
      
      eventPopup.style.left = left + 'px';
      eventPopup.style.top = top + 'px';
      eventPopup.classList.add('show');
    };
  });

  // Close popup when clicking elsewhere
  document.body.onclick = function(e) {
    if (!e.target.closest('.event-bar')) {
      eventPopup.classList.remove('show');
    }
  };
})();

function showEventPopup(el, e) {
  e.stopPropagation();
  const popup = document.getElementById('eventPopup');
  const data = el.dataset;
  const statusLabel = data.status === 'current' ? 'Current' : data.status === 'future' ? 'Upcoming' : 'Pending';
  
  popup.innerHTML = `
    <h3>${data.name} <span class="status-badge ${data.status}">${statusLabel}</span></h3>
    <div class="detail-row"><span class="detail-label">Dates</span><span class="detail-value">${data.dates}</span></div>
    <div class="detail-row"><span class="detail-label">Aircraft</span><span class="detail-value">${data.aircraft}</span></div>
    <div class="detail-row"><span class="detail-label">Pilots</span><span class="detail-value">${data.pilots}</span></div>
  `;
  
  const rect = el.getBoundingClientRect();
  popup.style.left = Math.min(rect.left, window.innerWidth - 290) + 'px';
  popup.style.top = (rect.top - 160) + 'px';
  popup.classList.add('show');
}

document.body.addEventListener('click', function(e) {
  if (!e.target.closest('.event-bar') && !e.target.closest('.event-popup')) {
    document.getElementById('eventPopup').classList.remove('show');
  }
});
</script>
</body>
</html>
